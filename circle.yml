machine:
  timezone:
    America/New_York
  services:
    - docker

checkout:
  post:

dependencies:
  pre:
    - sudo pip install awscli
    - wget https://releases.hashicorp.com/terraform/0.11.3/terraform_0.11.3_linux_amd64.zip
    - unzip terraform_0.11.3_linux_amd64.zip
    - docker info
    - ./terraform --version
    - cd infrastructure && pwd && bundler install
    - 

test:
  post:
    - cd infrastructure/terraform && ../../terraform get
    - docker run --rm -v ~/lambda_demo/insfrastructure/terraform/:/data -t wata727/tflint
    - ls -la && if [ -e function/*.csv ]; then echo true; fi
    - cd infrastructure && export AWS_SECRET_ACCESS_KEY=$(aws configure get aws_secret_access_key --profile default) && export AWS_ACCESS_KEY_ID=$(aws configure get aws_access_key_id --profile default) && rspec
    - ./terraform plan -detailed-exitcode
    
deployment:
  production:
    branch: master
    commands:

  staging:
    branch: forestry 
    commands:
